alias: Vew Assist Timers - llm-script-en
description: >-
  This script is the single entrypoint for the LLM to manage timers, alarms and
  reminders for View Assist. CALLING RULES (for the LLM / automation): - Always
  call this script in English. - Set the field `action` to exactly one of:
  set_timer, set_reminder,
    set_alarm, list, show, snooze, remaining, cancel
  - Optional fields:
    - `when` — an English time/duration phrase ("5 minutes", "tomorrow at 7:00 AM").
    - `name` — short label for the timer/alarm/reminder ("pizza", "meeting").
fields:
  action:
    name: action
    description: >-
      One of: set_timer, set_reminder, set_alarm, list, show, snooze, remaining,
      cancel
    required: true
    selector:
      select:
        options:
          - value: set_timer
            label: Set timer
          - value: set_reminder
            label: Set reminder
          - value: set_alarm
            label: Set alarm
          - value: list
            label: List timers
          - value: show
            label: Show timers
          - value: snooze
            label: Snooze
          - value: remaining
            label: Time remaining
          - value: cancel
            label: Cancel timer
  when:
    name: when
    description: >-
      Optional — English time/duration phrase, e.g. '5 minutes', 'tomorrow at
      9am'.
    required: false
    selector:
      text: {}
  name:
    name: name
    description: >-
      Optional — short label for the timer/alarm/reminder, e.g. 'boil eggs',
      'meeting'.
    required: false
    selector:
      text: {}
sequence:
  - variables:
      lang: en
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ action == 'set_timer' }}"
        sequence:
          - variables:
              payload_text: |-
                {% if when is defined and when != '' %}
                  set a timer for {{ when }}
                {% else %}
                  set a timer
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'set_reminder' }}"
        sequence:
          - variables:
              payload_text: >-
                {% if when is defined and when != '' and name is defined and
                name != '' %}
                  remind me at {{ when }} to {{ name }}
                {% elif name is defined and name != '' %}
                  remind me to {{ name }}
                {% elif when is defined and when != '' %}
                  remind me at {{ when }}
                {% else %}
                  remind me
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'set_alarm' }}"
        sequence:
          - variables:
              payload_text: >-
                {% if name is defined and name != '' and when is defined and
                when != '' %}
                  set a {{ name }} alarm for {{ when }}
                {% elif when is defined and when != '' %}
                  set an alarm for {{ when }}
                {% elif name is defined and name != '' %}
                  set a {{ name }} alarm
                {% else %}
                  set an alarm
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'list' }}"
        sequence:
          - data:
              text: list my timers
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'show' }}"
        sequence:
          - data:
              text: show my timers
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'snooze' }}"
        sequence:
          - variables:
              payload_text: |-
                {% if name is defined and name != '' %}
                  snooze my {{ name }}
                {% else %}
                  snooze my alarm
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'remaining' }}"
        sequence:
          - variables:
              payload_text: |-
                {% if name is defined and name != '' %}
                  how much time is left on my {{ name }}
                {% else %}
                  how much time is left on my timer
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
      - conditions:
          - condition: template
            value_template: "{{ action == 'cancel' }}"
        sequence:
          - variables:
              payload_text: |-
                {% if name is defined and name != '' %}
                  cancel my {{ name }} timer
                {% elif when is defined and when != '' %}
                  cancel my timer for {{ when }}
                {% else %}
                  cancel my timer
                {% endif %}
          - data:
              text: "{{ payload_text }}"
              language: "{{ lang }}"
              agent_id: conversation.home_assistant
            action: conversation.process
    default:
      - data:
          text: I did not understand the requested action
          language: "{{ lang }}"
          agent_id: conversation.home_assistant
        action: conversation.process
mode: single
