# Alarms, Reminders & Timers – LLM control for View Assist

This blueprint provides a **script-based control layer** that allows a **Large Language Model (LLM)** to fully manage **alarms, reminders, and timers** created with the  
[View Assist integration](https://github.com/dinki/view_assist_integration) in Home Assistant.

The script is designed to be executed **by an LLM**, but it can also be run manually from **Developer Tools → Scripts** for testing and debugging.

---

## What this script does

- Creates alarms, timers, and reminders
- Lists active alarms, timers, and reminders
- Shows the alarm UI on the View Assist display
- Handles alarm ringing, snoozing, and dismissing
- Acts as a **deterministic execution layer** for an LLM

> Spoken responses are **not generated by this script**.  
> All speech must be generated by the LLM itself.

---

## Requirements

### Mandatory
- [View Assist integration](https://github.com/dinki/view_assist_integration)

### Recommended
- [View Assist Companion App](https://github.com/msp1974/ViewAssist_Companion_App)

### Additional requirements
- An `input_text` helper used to store the **last active View Assist satellite**
- An automation that updates this helper whenever a satellite becomes active

You can install the required automation using this blueprint:

[![Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled.](https://my.home-assistant.io/badges/blueprint_import.svg)](https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=https://github.com/relust/View-Assist-ro-support/blob/main/LLM_scripts/blueprint-set_last_active_satellite.yaml)
---

## Installation

Import the script blueprint using the button below:

[![Open your Home Assistant instance and show the blueprint import dialog with a specific blueprint pre-filled.](https://my.home-assistant.io/badges/blueprint_import.svg)](https://my.home-assistant.io/redirect/blueprint_import/?blueprint_url=https://github.com/relust/View-Assist-ro-support/blob/main/LLM_scripts/Alarms_Reminders_Timers/blueprint-alarms_reminders_timers_llm_script.yaml)

After importing:
1. Create the script from the blueprint
2. Select the `input_text` helper that stores the last active satellite
3. (Optional) Adjust view path, alarm sound, and default snooze time

---

## How the LLM uses this script

The LLM must:
1. Select **exactly one Action**
2. Fill in **only the fields required** for that action

### Supported actions

### `set_timer`
Used for:
- “set a timer for 5 minutes”
- “set an alarm for 6:00”
- “remind me tomorrow at 7 to call John”

Required:
- `timer_type` (timer / alarm / reminder)
- `time`

Optional:
- `name`

---

### `list_timers`
Used for:
- “list my timers”
- “list my alarms”
- “list my reminders”

No additional fields required.

---

### `show_ui`
Used for:
- “show my timers”
- “show my alarms”
- “show my reminders”

Only navigates the UI.

---

### `timer_remaining`
Used for:
- “how much time is left on my timer”
- “how much time is left on my kitchen timer”

Optional:
- `name`

---

### `snooze_timer`
Used for:
- “snooze my alarm”
- “snooze the timer”

Required:
- `timer_id`

Optional:
- `snooze_minutes`

---

### `cancel_timer`
Used for:
- “cancel my alarm”
- “stop the timer”

Required:
- `timer_id`

---

### `alarm_ringing`
Internal action used when an alarm or timer starts ringing.  
Plays the alarm sound and shows the alarm UI.

---

### `dismiss_alarm`
Used for:
- “stop the alarm”
- “dismiss the alarm”

Required:
- `timer_id`

---

## Important: making timers visible to the LLM

View Assist stores alarms, reminders, and timers **inside sensor attributes**.  
Most LLM integrations can only access **sensor states**, not attributes.

This can cause the LLM to say:
> “You have no active timers”  
even though timers are clearly visible on the display.

---

## Solution: create an LLM-friendly template sensor

Create a **template sensor** that:
- Reads the `timers` attribute from the View Assist satellite sensor
- Converts it into a readable state and text attributes
- Can be exposed to voice assistants and LLMs

---

## Example template sensor

```yaml
sensor:
  - platform: template
    sensors:
      timers_office_satellite:
        friendly_name: "Active timers – Office Satellite"
        icon_template: mdi:timer

        # CHANGE THIS to your view_assist satellite sensor entity_id
        value_template: >
          {% set SATELLITE_SENSOR = 'sensor.office_satellite' %}
          {% set timers = state_attr(SATELLITE_SENSOR, 'timers') %}

          {% if not timers %}
            Active timers: 0
          {% else %}
            Active timers: {{ timers | count }}
            {% for t in timers %}
              | {{ t.name if t.name else 'Unnamed' }}
              ({{ t.timer_class }})
              expires at {{ as_timestamp(t.expires) | timestamp_custom('%H:%M', true) }}
            {% endfor %}
          {% endif %}
```
Add this to your `configuration.yaml` or included templates file:

- Replace **your View Assist satellite sensor** where indicated:

The template sensor will show: number of active timers, list of timers with name, type, and expiration time

Example: Active timers: 1 | make a coffe (reminder) expires at 13:36

## Expose to voice assistants

Go to Settings → Voice assistants → Expose

The LLM can now correctly answer queries like:

“What timers are active?”

“How much time is left on my alarm?”

This sensor is read-only; timer creation, cancellation, and snoozing are handled via the LLM script.
                     

                     
